<template>
  <div class="app-my-center-card">
    <div class="user-card">
      <div class="user-card-info">
        <div class="user-card-info-avatar">
          <base-image
              width="100%"
              height="100%"
              fit="cover"
              :src="userAvatar"
          />
        </div>
        <div class="user-card-info-body">
          <div class="user-card-info-body-left">
            <template v-if="!hasUserInfo">
              <p class="user-name">登录城市数藏</p>
              <p class="user-login-entry" @click="onToLogin">登录后查看个人藏品</p>
            </template>
            <template v-else>
              <p class="user-name" v-html="userInfo.NickName || '数藏用户' + (MobileNoNext)"></p>
              <template v-if="!userInfo.IsIdentityVerify">
                <p class="user-desc">兑换藏品前，请先 <span class="real-name" @click="onToAuthentication">实名认证</span></p>
              </template>
              <template v-else>
                <p class="user-desc">
                  <svg xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" version="1.1"
                       width="15px" height="12px">
                    <g>
                      <path
                          d="M 0 1.2576376535651  C 0 0.584749424177744  0.569041421924339 0  1.22384780026709 0  C 1.22384780026709 0  13.5085702526412 0  13.5085702526412 0  C 14.1633754748727 0  14.7324180529083 0.584743464826488  14.7324180529083 1.2576376535651  C 14.7324180529083 1.2576376535651  14.7324180529083 6.11241124291223  14.7324180529083 6.11241124291223  C 14.0386773162497 5.39124630892684  13.0721266974604 4.94265375871191  11.9806420733546 4.94266210180353  C 9.79813526963994 4.94266210180353  8.00551542136782 6.74516324152955  7.99761918158106 9.03640269720245  C 7.99761918158106 9.84544184120114  8.22360424616545 10.5584686850991  8.61322529602239 11.1912206837164  C 8.61322529602239 11.1912206837164  1.22384780026709 11.1912206837164  1.22384780026709 11.1912206837164  C 0.568780140783474 11.1912206837164  0 10.6064772188899  0 9.93358303015134  C 0 9.93358303015134  0 1.2576376535651  0 1.2576376535651  Z M 9.05546096852845 9.06896459251448  C 9.05546096852845 7.45034519542196  10.3861218864961 6.13792918502895  12.0277304842641 6.13792918502895  C 13.6693506431448 6.13792918502895  15 7.45034519542196  15 9.06896459251448  C 15 10.687858119765  13.6693390820324 12  12.0277304842641 12  C 10.3861103253837 12  9.05546096852845 10.687858119765  9.05546096852845 9.06896459251448  Z M 8.78764548696563 2.13150500436518  C 8.78764548696563 2.26494322228086  8.91576573486668 2.39811088564898  9.04362238940439 2.39811088564898  C 9.04362238940439 2.39811088564898  13.1842348046519 2.39811088564898  13.1842348046519 2.39811088564898  C 13.3120914591898 2.39811088564898  13.4399481137275 2.26494322228086  13.4399481137275 2.13150500436518  C 13.4399481137275 1.99860908741471  13.3120914591898 1.86516967762896  13.1842348046519 1.86516967762896  C 13.1842348046519 1.86516967762896  9.04336804493119 1.86516967762896  9.04362238940439 1.86516967762896  C 8.91576573486668 1.86516967762896  8.78764548696563 1.99833734099707  8.78764548696563 2.13150500436518  Z M 9.04362238940439 3.99693331783897  C 9.04362238940439 3.99693331783897  13.1842348046519 3.99693331783897  13.1842348046519 3.99693331783897  C 13.3120914591898 3.99693331783897  13.4399481137275 3.86349509992328  13.4399481137275 3.73032743655517  C 13.4399481137275 3.59715977318706  13.3120914591898 3.46399210981895  13.1842348046519 3.46399210981895  C 13.1842348046519 3.46399210981895  9.04336804493119 3.46399210981895  9.04362238940439 3.46399210981895  C 8.91576573486668 3.46399210981895  8.78764548696563 3.59715977318706  8.78764548696563 3.73032743655517  C 8.78764549852667 3.86349509992328  8.91576573486668 3.99693331783897  9.04362238940439 3.99693331783897  Z M 6.70852036289216 9.1516825945082  C 6.87636459308783 9.1118137002361  7.00632652619834 9.1118137002361  7.1360248659455 9.06435080464689  C 7.22021034318436 9.0247531800444  7.26572320569267 9.0247531800444  7.34990891415373 8.97701901478558  C 7.39568479196964 8.93742139018309  7.43383126047388 8.80262694310659  7.47961197823724 8.58050040672583  C 7.51775856235258 8.35864567783142  7.47961197823724 8.08878479888676  7.44146539412213 7.73213431185877  C 7.44146539412213 7.55747049376214  7.35727991688327 7.42294767391627  7.2275813459139 7.28788136123489  C 7.09788300616674 7.15308679497139  6.96818466641957 7.06575488592307  6.80007684286056 7.01829222870788  C 6.63223261266489 6.93096043884657  6.45649445490517 6.89136281424408  6.28865021853676 6.84390015525855  C 6.12055858053532 6.79569400937976  5.96079094348011 6.72075135323712  5.81510705301594 6.62177367971981  C 5.71786503345925 6.58277926065216  5.62953501302673 6.52339527879235  5.55571037352161 6.44738160804059  C 5.50993449570547 6.40778398343809  5.47178802720146 6.36004981817928  5.42601203377444 6.27271778994395  C 5.3802361559583 6.23312016534123  5.3802361559583 6.18565726975203  5.3802361559583 6.09832571826473  C 5.3802361559583 6.09832571826473  5.3802361559583 5.87647098937055  5.3802361559583 5.87647098937055  C 5.3802361559583 5.7414046766894  5.42601203377444 5.65407276764108  5.50993449570547 5.56728435142804  C 5.55571037352161 5.47995256156673  5.63963283545286 5.4322180387469  5.72381854391392 5.34488612969835  C 5.76959442172983 5.34488612969835  5.80774089023384 5.25782560950665  5.85351688366109 5.21009156343484  C 5.8916634677762 5.12303104324315  5.8916634677762 5.07529699717134  5.93770236089995 4.98823683454066  C 5.97558581409635 4.89303977369264  5.97558581409635 4.80570786464432  6.02136169191226 4.71864770201364  C 6.05950827602737 4.71864770201364  6.10554716915112 4.71864770201364  6.18946951547127 4.67091353675482  C 6.2733918617912 4.58358174689351  6.31153867712874 4.49652146507583  6.35731374566694 4.36172689881232  C 6.40308962348286 4.2665298379643  6.40308962348286 4.17919792891598  6.40308962348286 4.0921377662853  C 6.40308962348286 4.04440360102649  6.40308962348286 3.95707145360393  6.36494303936774 3.90960879638897  C 6.36494303936774 3.82227700652766  6.32679645525241 3.78267938192494  6.28102069304759 3.73521672470974  C 6.31916727716271 3.33083302591922  6.23524481523168 2.9343132870581  6.15132235330043 2.5771216909352  C 6.05950758236077 2.40272961925621  6.02136157630116 2.22047120390721  5.891663236554 2.04607913222821  C 5.76196489680683 1.91128456596471  5.67804278170888 1.77648999970097  5.5480808485986 1.68915809065265  C 5.33446039375349 1.55436352438915  5.08243045509676 1.42743410992534  4.82303377560243 1.37997145271015  C 4.69307299860316 1.33223728745133  4.6091497273942 1.33223728745133  4.47945138764703 1.33223728745133  C 4.39552904132711 1.33223728745133  4.18164545556306 1.37997145271015  4.05194711581589 1.37997145271015  C 3.79991717715916 1.41956907731264  3.54025690430149 1.51476601897366  3.32663649758319 1.68915805744609  C 3.1901668142882 1.78331974060529  3.07334755378338 1.90467442033491  2.98305522449164 2.04607915369206  C 2.86384975038186 2.20407705004095  2.77573441980735 2.38456196245352  2.72365855175372 2.57739223741737  C 2.63684188093794 2.95681578936956  2.59322723747891 3.34537979429183  2.59369777475467 3.73521671664457  C 2.55555119063933 3.77481434124707  2.55555119063933 3.8621461311086  2.50977542843452 3.90960878832357  C 2.46399955061861 3.94920641292629  2.46399955061861 4.0365382027876  2.46399955061861 4.08400086000279  C 2.46399955061861 4.17919792085058  2.46399955061861 4.26652982989913  2.50977542843452 4.35358999252981  C 2.50977542843452 4.48865630521095  2.59396090567338 4.57598821425927  2.68524999283113 4.66277663047231  C 2.68524999283113 4.66277663047231  2.72365959225385 4.71051079573112  2.76943547006999 4.71051079573112  C 2.8075820541851 4.80570785657915  2.8075820541851 4.89303976562746  2.85335781638992 4.98009992825814  C 2.89150440050526 5.06743171811945  2.89150440050526 5.11489449452165  2.94490945641087 5.21009155536967  C 2.94490945641087 5.21009155536967  3.07460779615803 5.34488612163318  3.07460779615803 5.34488612163318  C 3.07460779615803 5.34488612163318  3.28849184436626 5.56728434336264  3.28849184436626 5.56728434336264  C 3.37267732160512 5.65407371307197  3.41819018411343 5.7414058604943  3.41819018411343 5.87647098130537  C 3.41819018411343 5.87647098130537  3.41819018411343 6.09832571019956  3.41819018411343 6.09832571019956  C 3.41819018411343 6.13792333480205  3.41819018411343 6.22525512466359  3.37241430629751 6.27271778187855  C 3.3266384284816 6.31258667615089  3.28822882905865 6.39964719634258  3.24271596655035 6.44738159997542  C 3.1511643265294 6.48697922457791  3.06697896490164 6.57431101443922  2.98305674301537 6.62177374278599  C 2.83668034248285 6.71927433127189  2.67722254324076 6.79411341388936  2.50977717142382 6.84390021809782  C 2.34193294122838 6.88349784270031  2.16619478346843 6.97082963256162  1.99835055327276 7.01829228977681  C 1.83024272971397 7.11321808095522  1.70054438996658 7.20082125967315  1.57084605021942 7.28788142230383  C 1.44088527322015 7.37521321216536  1.35696200201119 7.55747055483084  1.35696200201119 7.7321343729277  C 1.31118612419527 8.08878485995569  1.26541036199023 8.35864454703005  1.31118612419527 8.58050046779454  C 1.35696200201119 8.80262694310659  1.39537160143414 8.92955635757039  1.44088446394244 8.97701901478558  C 1.48692335706596 9.01661663938808  1.57084524094171 9.06435080464689  1.65476851215067 9.06435080464689  C 1.78446685189783 9.10394842924961  1.9144276288971 9.10394842924961  2.08227301520401 9.1516825945082  C 2.25774757960062 9.19128021911092  2.4258554031594 9.19128021911092  2.63947585800452 9.23874311470013  C 3.02120413640841 9.27834073930262  3.41056159290201 9.27834073930262  3.83806262762164 9.32607490456144  C 3.83806262762164 9.32607490456144  4.95273075047453 9.32607490456144  4.95273075047453 9.32607490456144  C 5.33419659162632 9.32607490456144  5.76959271002147 9.28647727995894  6.15131752009165 9.23874311470013  C 6.36493797493677 9.19914549009741  6.54067497658525 9.19914549009741  6.70852036289216 9.1516825945082  Z M 12.2616036958564 10.6680483065015  L 13.6585560324729 8.4410864135732  L 13.9661001207751 8.4410905255254  L 13.9653108783132 8.00578732863141  L 13.4270497621108 8.00578732863141  L 12.4615477362186 9.51456396320714  L 11.6310055123383 8.00470272670123  L 10.6063105908268 8.00334664056481  L 10.6070998332887 8.43431023786752  L 10.946735257462 8.43593753408027  L 12.2616036958564 10.6680483065015  Z "
                          fill-rule="nonzero" fill="#ffffff" stroke="none"/>
                    </g>
                  </svg>
                  <span style="padding: 0 10px 0 5px;">已实名认证</span>
                  <span>{{ userInfo.MobileNo | filterMobileNo }}</span>
                </p>
              </template>
            </template>
          </div>
          <div v-if="hasUserInfo" class="user-card-info-body-right" @click="onToEditUserInfo">
            <span>编辑</span>
          </div>
        </div>
      </div>
    </div>
    <div class="user-card-grid">
      <Grid :column-num="4" :border="false">
        <GridItem text="藏品合成" @click="onShowUnderDevelopmentTip">
          <template #icon>
            <img class="user-card-grid-item-icon" src="/static/images/my-center/collection-synthetic.png" alt="">
          </template>
        </GridItem>
        <GridItem text="转赠记录" @click="onShowUnderDevelopmentTip('examples')">
          <template #icon>
            <img class="user-card-grid-item-icon" src="/static/images/my-center/turn-records-icon.png" alt="">
          </template>
        </GridItem>
        <GridItem text="我的权益" @click="onShowUnderDevelopmentTip">
          <template #icon>
            <img class="user-card-grid-item-icon" src="/static/images/my-center/my-dream-icon.png" alt="">
          </template>
        </GridItem>
        <GridItem text="我的消息" @click="onShowUnderDevelopmentTip('myNews')">
          <template #icon>
            <img class="user-card-grid-item-icon" src="/static/images/my-center/my-message-icon.png" alt="">
            <!-- <div v-if="Number(TotalCount) > 0" class="infos">{{Number(TotalCount) >99 ?  '99+' : TotalCount}}</div> -->
          </template>
        </GridItem>
      </Grid>
    </div>
  </div>
</template>

<script>
import { userApi } from '@/api'
import { Image, Grid, GridItem } from 'vant'
import { mapGetters } from 'vuex'
import getImageUrl from "@/utils/get-image-url";
import underDevelopmentTip from '@/utils/under-development-tip'

export default {
  components: {
    BaseImage: Image,
    Grid,
    GridItem
  },
  data () {
    return {
      TotalCount:''
    }
  },
  computed: {
    ...mapGetters(['hasUserInfo', 'userInfo']),
    userAvatar() {
      return getImageUrl(this.userInfo.UserHead) || '/static/images/avatar.png'
    },
    MobileNoNext() {
      const value = this.userInfo.MobileNo || ''
      return value.slice(value.length - 4)
    }
  },
  created () {
    this.getuserInfo()
  },
  methods: {
    getuserInfo () {
      const params = {
        userID:this.userInfo.ID,
        pageIndex:0,
        pageSize:9999
      }
      userApi.getUnreadMessages(params).then(res=>{
        console.log(res)
        this.TotalCount = res.TotalCount
      })
    },
    // 编辑信息
    onToEditUserInfo() {
      this.$router.push('/city-meta/edit-userinfo')
    },

    // 前往登录页面
    onToLogin() {
      this.$router.push('/city-meta/verification-code-login')
    },

    // 实名认证页面
    onToAuthentication() {
      this.$router.push('/city-meta/authentication')
    },

    onShowUnderDevelopmentTip(v) {
      if (v==='examples'){
        this.$router.push('examples-record')
      } else{
        underDevelopmentTip()
      }
      //  else if (v==='myNews') {
      //   this.$router.push('my-news')
      // } 
    }
  },
}
</script>

<style scoped lang="less">
.app-my-center-card {
  padding: 0 24px;
  box-sizing: border-box;
  background-image: url(/public/static/images/my-center/background.png);
  background-repeat: no-repeat;
  background-size: 100% auto;
  background-position: 0 0;

  .user-card {
    padding-top: 36px;

    &-tips {
      height: 36px;
      line-height: 36px;
      text-align: center;
      font-size: 12px;
      font-family: PingFangSC, PingFangSC-Regular;
      font-weight: 400;
      color: #666666;
    }

    &-info {
      display: flex;
      align-items: center;

      &-avatar {
        width: 48px;
        height: 48px;
        margin-right: 14px;
        border-radius: 50%;
        overflow: hidden;
      }

      &-body {
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex: 1;

        &-left {
          flex: 1;

          .user-name {
            font-size: 18px;
            font-family: PingFangSC, PingFangSC-Medium;
            font-weight: 500;
            text-align: left;
            color: #ffffff;
          }

          .user-login-entry {
            font-size: 12px;
            font-family: PingFangSC, PingFangSC-Regular;
            font-weight: 400;
            text-align: left;
            color: #91B3F7;
            margin-top: 10px;
          }

          .user-desc {
            font-size: 12px;
            font-family: PingFangSC, PingFangSC-Regular;
            font-weight: 400;
            text-align: left;
            color: #666666;
            margin-top: 10px;
            display: flex;
            align-items: center;

            .real-name {
              font-size: 12px;
              font-family: PingFangSC, PingFangSC-Regular;
              font-weight: 400;
              color: #EECE76;
            }
          }
        }

        &-right {
          width: 64px;
          height: 26px;
          //opacity: 0.1;
          background-color: rgba(255, 255, 255, 0.1);
          //background: #ffffff;
          border-radius: 15px;
          text-align: center;
          line-height: 26px;
          font-size: 12px;
          font-family: PingFangSC, PingFangSC-Regular;
          font-weight: 400;
          color: #aaaaaa;
        }
      }
    }

    &-grid {
      padding: 20px 0 10px 0;

      &-item {
        &-icon {

          width: 20px;
          object-fit: cover;
          margin-bottom: 12px;
          position: relative;
        }
      }
    }
  }
  .infos {
    position: absolute;
    top: -10px;
    right:-15px;
        box-sizing: border-box;
    min-width: 16px;
    padding: 0 3px;
    color: #fff;
    font-weight: 500;
    font-size: 12px;
    font-family: -apple-system-font, Helvetica Neue, Arial, sans-serif;
    line-height: 13px;
    text-align: center;
    background-color: #ee0a24;
    border: 1px solid #fff;
    border-radius: 16px;
  }
}
</style>
